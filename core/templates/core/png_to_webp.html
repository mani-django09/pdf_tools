{% extends 'base.html' %}

{% block title %}PNG to WebP Converter | Convert PNG to WebP Online | ilovepdf.link{% endblock %}

{% load static %}

{% block extra_css %}
<style>
    .dropzone {
        border: 2px dashed #0d6efd;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        cursor: pointer;
    }
    
    .dropzone.dragover {
        background-color: #e9ecef;
        border-color: #0b5ed7;
    }
    
    .file-item {
        background-color: #f8f9fa;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .file-info {
        display: flex;
        align-items: center;
        flex: 1;
    }
    
    .file-icon {
        margin-right: 15px;
        color: #0d6efd;
    }
    
    .progress {
        height: 5px;
        margin-top: 5px;
        width: 100%;
    }
    
    .actions {
        display: flex;
        gap: 10px;
    }
    
    .thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 5px;
        margin-right: 15px;
    }
    
    .preview-container {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        position: relative;
    }
    
    .preview-image {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .preview-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(255,255,255,0.8);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }
    
    .result-container {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 30px;
        text-align: center;
        display: none;
    }
    
    .result-preview {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .result-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    
    .compare-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
        justify-content: center;
    }
    
    .compare-item {
        flex: 1;
        min-width: 300px;
        text-align: center;
    }
    
    .compare-image {
        max-width: 100%;
        max-height: 250px;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .file-details {
        margin-top: 10px;
    }
    
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255,255,255,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        display: none;
    }
    
    .loading-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        text-align: center;
    }
    
    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
    
    .file-size-reduction {
        display: inline-block;
        background-color: #d1e7dd;
        color: #0f5132;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
        margin-left: 10px;
    }
</style>
{% endblock %}

{% block content %}
<section class="tool-header py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="mb-3">PNG to WebP Converter</h1>
                <p class="lead mb-4">Convert PNG to WebP online with ilovepdf.link's free PNG to WebP converter tool. Reduce file size by up to 80% while maintaining image quality.</p>
            </div>
        </div>
    </div>
</section>

<section class="converter py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body">
                        <form id="convertForm" enctype="multipart/form-data">
                            <div id="dropzone" class="dropzone mb-4">
                                <div class="dropzone-content">
                                    <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>
                                    <h4>Drag & Drop PNG files here</h4>
                                    <p class="mb-2">Convert PNG to WebP instantly with ilovepdf.link's free converter</p>
                                    <p>or</p>
                                    <button type="button" id="browseButton" class="btn btn-primary">
                                        <i class="fas fa-file-image me-2"></i> Browse PNG Files
                                    </button>
                                    <input type="file" id="fileInput" multiple accept=".png" class="d-none">
                                </div>
                            </div>
                            
                            <!-- Preview Container -->
                            <div id="previewContainer" class="preview-container mb-4 d-none">
                                <img id="previewImage" class="preview-image" src="" alt="Preview">
                                <div id="previewLoading" class="preview-loading">
                                    <div class="spinner-border text-primary mb-2" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mb-0">Loading preview...</p>
                                </div>
                            </div>
                            
                            <div id="fileList" class="mb-4 d-none">
                                <h5 class="mb-3">Files to Convert</h5>
                                <div id="fileItems"></div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" id="convertButton" class="btn btn-primary btn-lg" disabled>
                                    <i class="fas fa-exchange-alt me-2"></i> Convert to WebP
                                </button>
                            </div>
                        </form>
                        
                        <!-- Conversion Result -->
                        <div id="resultContainer" class="result-container">
                            <h4 class="mb-3">Conversion Completed</h4>
                            <img id="resultPreview" class="result-preview" src="" alt="Converted WebP">
                            <div class="file-details mb-3">
                                <p id="resultFileName" class="mb-1 fw-bold"></p>
                                <p id="resultFileSize" class="text-muted"></p>
                                <p id="sizeDifference" class="mb-0"><span class="file-size-reduction">Size reduced by 0%</span></p>
                            </div>
                            <div class="result-actions">
                                <button id="downloadButton" class="btn btn-success">
                                    <i class="fas fa-download me-2"></i> Download WebP
                                </button>
                                <button id="newConversionButton" class="btn btn-outline-primary">
                                    <i class="fas fa-redo me-2"></i> New Conversion
                                </button>
                            </div>
                            
                            <!-- Comparison View -->
                            <div class="compare-container">
                                <div class="compare-item">
                                    <h5>Original PNG</h5>
                                    <img id="compareOriginal" class="compare-image" src="" alt="Original PNG">
                                    <div id="originalDetails" class="file-details text-muted small"></div>
                                </div>
                                <div class="compare-item">
                                    <h5>Converted WebP</h5>
                                    <img id="compareConverted" class="compare-image" src="" alt="Converted WebP">
                                    <div id="convertedDetails" class="file-details text-muted small"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Global Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-content">
        <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h5 id="loadingMessage">Converting image...</h5>
        <p class="text-muted">Please wait, this may take a moment</p>
    </div>
</div>

<section class="tool-info py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <h3>About PNG to WebP Conversion</h3>
                <p><strong>Why convert PNG to WebP?</strong> WebP is a modern image format developed by Google that offers excellent compression while maintaining high image quality. Converting PNG to WebP with ilovepdf.link's PNG to WebP converter can reduce your image file sizes by up to 80% compared to PNG files, while preserving visual quality and transparency.</p>
                <p>PNG (Portable Network Graphics) files are lossless and great for quality, but they can be quite large, especially for complex images. WebP achieves much smaller file sizes through advanced compression techniques, making it ideal for websites and apps where faster loading times are crucial.</p>
                <h4 class="mt-4">Benefits of Converting PNG to WebP</h4>
                <ul>
                    <li><strong>Drastically Smaller Files:</strong> WebP files are typically 25-80% smaller than PNG files of the same image.</li>
                    <li><strong>Faster Website Loading:</strong> Smaller image sizes mean faster page loads and better user experience.</li>
                    <li><strong>Lower Bandwidth Usage:</strong> Reduce data usage for your website visitors and lower hosting costs.</li>
                    <li><strong>SEO Advantages:</strong> Faster sites tend to rank better in search engines like Google.</li>
                    <li><strong>Full Transparency Support:</strong> WebP maintains alpha channel transparency just like PNG.</li>
                </ul>
                <p>At ilovepdf.link, our PNG to WebP converter uses advanced algorithms to optimize the conversion process, ensuring you get the smallest possible WebP file without sacrificing visual quality.</p>
            </div>
            <div class="col-lg-6">
                <h3>How to Use Our PNG to WebP Converter</h3>
                <ol>
                    <li><strong>Upload Your PNG Files:</strong> Drag and drop your PNG images into the upload area or click "Browse Files" to select them from your device.</li>
                    <li><strong>Preview Your Image:</strong> See an instant preview of your PNG image to confirm it's the one you want to convert.</li>
                    <li><strong>Convert PNG to WebP:</strong> Click the "Convert to WebP" button to start the PNG to WebP conversion process.</li>
                    <li><strong>Compare Results:</strong> View a side-by-side comparison of your original PNG and newly converted WebP image, along with file size reduction information.</li>
                    <li><strong>Download Your WebP File:</strong> Click the "Download WebP" button to save your converted image.</li>
                </ol>
                <p>ilovepdf.link's PNG to WebP converter lets you convert multiple PNG files to WebP format in bulk. Our tool preserves image quality and transparency in your WebP output with no watermarks.</p>
                <h4 class="mt-4">Technical Specifications</h4>
                <ul>
                    <li>Maximum file size: 50MB per PNG image</li>
                    <li>Batch processing: Convert multiple PNG files to WebP at once</li>
                    <li>Compression quality: 85% (optimized for web use while maintaining quality)</li>
                    <li>Transparency support: Full alpha channel preservation</li>
                    <li>Color depth: Support for 24-bit true color</li>
                    <li>Resolution: Maintains original image dimensions</li>
                </ul>
            </div>
        </div>
        
        <div class="row mt-5">
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h4>100% Secure PNG to WebP Conversion</h4>
                        <p>At ilovepdf.link, your privacy is our priority. Your PNG files are processed securely and deleted from our servers automatically after conversion. We never share or store your images.</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-tachometer-alt fa-3x text-primary mb-3"></i>
                        <h4>Lightning-Fast Conversion</h4>
                        <p>Our advanced PNG to WebP converter uses optimized algorithms to convert your PNG files to WebP format in seconds, saving you time and improving productivity.</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-gem fa-3x text-primary mb-3"></i>
                        <h4>Optimal Compression</h4>
                        <p>ilovepdf.link's PNG to WebP converter achieves the perfect balance between file size reduction and image quality. See the difference with our before-and-after comparison.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="faq py-5">
    <div class="container">
        <h2 class="text-center mb-5">Frequently Asked Questions About PNG to WebP Conversion</h2>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                What is the difference between PNG and WebP formats?
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>PNG and WebP are both image formats with different strengths:</p>
                                <p><strong>PNG (Portable Network Graphics):</strong> Developed in the late 1990s, PNG is a lossless format that offers excellent quality and transparency support. PNG files preserve all image data, resulting in perfect quality but larger file sizes. They're universally supported across all browsers, platforms, and applications.</p>
                                <p><strong>WebP:</strong> Developed by Google in 2010, WebP is a modern image format that offers both lossy and lossless compression options. WebP can achieve 25-80% smaller file sizes compared to PNG while maintaining similar visual quality. WebP also supports transparency and animation. The main limitation is that some older browsers and applications don't support WebP, though this is becoming less of an issue.</p>
                                <p>The primary reason to convert PNG to WebP using ilovepdf.link's converter is to significantly reduce file sizes for web usage while maintaining high image quality and transparency.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                Does the PNG to WebP converter preserve transparency?
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>Yes, ilovepdf.link's PNG to WebP converter fully preserves transparency when converting from PNG to WebP. Both PNG and WebP formats support alpha channel transparency, allowing for partially or fully transparent areas in images.</p>
                                <p>Our PNG to WebP conversion tool ensures that:</p>
                                <ul>
                                    <li>All transparent areas in your PNG image remain transparent in the WebP output</li>
                                    <li>Semi-transparent pixels maintain their exact opacity levels</li>
                                    <li>The alpha channel information is completely preserved during conversion</li>
                                </ul>
                                <p>This makes our PNG to WebP converter perfect for converting logos, icons, product images with transparent backgrounds, and other graphics that use transparency. You can be confident that your WebP files will look identical to your original PNG images, with all transparency effects intact but with much smaller file sizes.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                How much smaller are WebP files compared to PNG?
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>When converting PNG to WebP using ilovepdf.link's converter, you can expect significant file size reductions:</p>
                                <ul>
                                    <li><strong>25-35% reduction</strong> for lossless WebP compression (perfect quality preservation)</li>
                                    <li><strong>60-80% reduction</strong> for lossy WebP compression at high quality settings (minimal visual difference)</li>
                                </ul>
                                <p>The exact reduction depends on several factors:</p>
                                <ul>
                                    <li><strong>Image content:</strong> Images with large areas of solid color or simple patterns compress better</li>
                                    <li><strong>Original PNG size:</strong> Larger, more detailed PNGs often see higher percentage reductions</li>
                                    <li><strong>Quality settings:</strong> Our converter uses an optimal 85% quality setting that balances size and quality</li>
                                </ul>
                                <p>Our PNG to WebP converter shows you the exact size reduction achieved for each image with a side-by-side comparison. This helps you understand exactly how much bandwidth you're saving by switching to WebP format.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingFour">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                Which browsers support WebP images?
                            </button>
                        </h2>
                        <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>WebP format is now supported by the vast majority of modern web browsers. As of 2025, WebP is supported by:</p>
                                <ul>
                                    <li><strong>Google Chrome:</strong> Full support since version 17 (2012)</li>
                                    <li><strong>Mozilla Firefox:</strong> Full support since version 65 (2019)</li>
                                    <li><strong>Microsoft Edge:</strong> Full support since version 18 (2018)</li>
                                    <li><strong>Safari:</strong> Full support since version 14 (2020)</li>
                                    <li><strong>Opera:</strong> Full support since version 11.10 (2011)</li>
                                    <li><strong>Samsung Internet:</strong> Full support</li>
                                    <li><strong>Mobile browsers:</strong> Widely supported on Android and iOS</li>
                                </ul>
                                <p>Current global WebP support is over 95% of all internet users. For the small percentage of users with older browsers, it's recommended to implement a fallback system where PNG or JPEG images are served if WebP isn't supported.</p>
                                <p>For websites, you can use the <code>&lt;picture&gt;</code> HTML element to provide both WebP and PNG versions, ensuring compatibility with all browsers while still benefiting from WebP's smaller size for the majority of users.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingFive">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                Is there any quality loss when converting PNG to WebP?
                            </button>
                        </h2>
                        <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>The quality impact when converting PNG to WebP depends on the compression mode used:</p>
                                <ul>
                                    <li><strong>Lossless WebP:</strong> When using lossless compression, there is no quality loss at all. The WebP image will be visually identical to the original PNG, just with a smaller file size (typically 25-35% smaller).</li>
                                    <li><strong>Lossy WebP with high quality settings:</strong> ilovepdf.link's PNG to WebP converter uses a high-quality setting (85%) that preserves visual details while maximizing file size reduction. At this quality level, most people cannot distinguish between the original PNG and the converted WebP image in side-by-side comparisons.</li>
                                </ul>
                                <p>Our converter strikes the perfect balance between quality preservation and file size reduction. The visual differences are typically imperceptible to the human eye, especially for photographic content. For graphics with sharp edges and text, our high-quality settings ensure clarity is maintained.</p>
                                <p>After conversion, our tool shows you a side-by-side comparison so you can verify the quality yourself before downloading. For critical design work where absolute pixel-perfect reproduction is required, you can use the WebP images for web deployment while keeping your original PNG files as your master copies.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingSix">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                How do I use WebP images on my website?
                            </button>
                        </h2>
                        <div id="collapseSix" class="accordion-collapse collapse" aria-labelledby="headingSix" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <p>After converting your PNG images to WebP format using ilovepdf.link's converter, here's how to use them on your website:</p>
                                <h5 class="mt-3">Basic Implementation</h5>
                                <p>You can use WebP images just like any other image format with the standard HTML image tag:</p>
                                <pre><code>&lt;img src="image.webp" alt="Description of image" /&gt;</code></pre>
                                
                                <h5 class="mt-3">Fallback for Older Browsers</h5>
                                <p>For maximum compatibility, use the HTML5 &lt;picture&gt; element to provide fallbacks:</p>
                                <pre><code>&lt;picture&gt;
  &lt;source srcset="image.webp" type="image/webp"&gt;
  &lt;source srcset="image.png" type="image/png"&gt;
  &lt;img src="image.png" alt="Description of image"&gt;
&lt;/picture&gt;</code></pre>
                                <p>This code first tries to load the WebP version, then falls back to PNG if WebP isn't supported.</p>
                                
                                <h5 class="mt-3">CSS Background Images</h5>
                                <p>For CSS backgrounds, you can use feature detection:</p>
                                <pre><code>.modernizr-webp .element {
  background-image: url('image.webp');
}

.modernizr-no-webp .element {
  background-image: url('image.png');
}</code></pre>
                                <p>You'll need to use a script like Modernizr to detect WebP support and add the appropriate class to your HTML element.</p>
                                
                                <p>By implementing WebP images with proper fallbacks, you can significantly improve your website's loading speed for most users while maintaining compatibility with all browsers.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="additional-info py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <h2 class="text-center mb-5">Why Choose ilovepdf.link's PNG to WebP Converter</h2>
                
                <div class="mb-5">
                    <h3>When to Convert PNG to WebP</h3>
                    <p>Converting PNG to WebP with our tool is especially beneficial in these scenarios:</p>
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5><i class="fas fa-globe text-primary me-2"></i> Website Optimization</h5>
                                    <p>If you're looking to improve your website's loading speed and performance, converting PNG images to WebP can dramatically reduce page load times, especially for image-heavy sites.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5><i class="fas fa-mobile-alt text-primary me-2"></i> Mobile Apps</h5>
                                    <p>For mobile applications where bandwidth and storage are concerns, WebP images reduce data usage and improve app performance while maintaining visual quality.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5><i class="fas fa-search text-primary me-2"></i> SEO Improvements</h5>
                                    <p>Page speed is a ranking factor for search engines. Using WebP images can help improve your site's SEO performance by making pages load faster.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5><i class="fas fa-server text-primary me-2"></i> Reducing Hosting Costs</h5>
                                    <p>If you're paying for bandwidth or storage, converting PNG to WebP can reduce your hosting costs by decreasing the total data transferred and stored.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5">
                    <h3>Best Practices for PNG to WebP Conversion</h3>
                    <p>To maximize the benefits of converting PNG to WebP with our tool, follow these professional tips:</p>
                    <ol class="mt-4">
                        <li class="mb-3"><strong>Implement proper fallbacks:</strong> Always provide PNG fallbacks for browsers that don't support WebP, using the &lt;picture&gt; element or server-side detection.</li>
                        <li class="mb-3"><strong>Maintain your original PNGs:</strong> Keep your original PNG files as master copies for editing and future use.</li>
                        <li class="mb-3"><strong>Check compression results:</strong> Use our side-by-side comparison to verify the quality and file size savings for each conversion.</li>
                        <li class="mb-3"><strong>Batch process for efficiency:</strong> Convert multiple PNG files to WebP at once for greater efficiency.</li>
                        <li class="mb-3"><strong>Consider animation needs:</strong> If you need animation, WebP supports this feature unlike static PNG files.</li>
                    </ol>
                </div>
                
                <div class="alert alert-info mt-5" role="alert">
                    <h4 class="alert-heading"><i class="fas fa-lightbulb me-2"></i> Pro Tip!</h4>
                    <p>When using WebP images on your website, implement lazy loading for even better performance. Only load images when they're about to enter the viewport, further speeding up initial page load times.</p>
                    <hr>
                    <p class="mb-0">At ilovepdf.link, we provide all the tools you need for complete image format management, including PNG to WebP conversion, image compression, and other essential web optimization tools.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elements
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const browseButton = document.getElementById('browseButton');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const convertButton = document.getElementById('convertButton');
        const convertForm = document.getElementById('convertForm');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const previewLoading = document.getElementById('previewLoading');
        const resultContainer = document.getElementById('resultContainer');
        const resultPreview = document.getElementById('resultPreview');
        const resultFileName = document.getElementById('resultFileName');
        const resultFileSize = document.getElementById('resultFileSize');
        const sizeDifference = document.getElementById('sizeDifference');
        const downloadButton = document.getElementById('downloadButton');
        const newConversionButton = document.getElementById('newConversionButton');
        const compareOriginal = document.getElementById('compareOriginal');
        const compareConverted = document.getElementById('compareConverted');
        const originalDetails = document.getElementById('originalDetails');
        const convertedDetails = document.getElementById('convertedDetails');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingMessage = document.getElementById('loadingMessage');
        
        // Files to be converted
        let files = [];
        let currentFile = null;
        let convertedBlob = null;
        let convertedFileName = '';
        let originalFileSize = 0;
        let convertedFileSize = 0;
        
        // Handle browse button click
        browseButton.addEventListener('click', function() {
            fileInput.click();
        });
        
        // Handle file selection
        fileInput.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });
        
        // Handle drag and drop events
        dropzone.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.add('dragover');
        });
        
        dropzone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove('dragover');
        });
        
        dropzone.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove('dragover');
            
            if (e.dataTransfer.files.length > 0) {
                handleFiles(e.dataTransfer.files);
            }
        });
        
        // Handle files
        function handleFiles(fileList) {
            // Filter for PNG files
            const pngFiles = Array.from(fileList).filter(file => 
                file.type === 'image/png' || file.name.toLowerCase().endsWith('.png')
            );
            
            if (pngFiles.length === 0) {
                alert('Please select PNG image files only. Other image formats are not supported.');
                return;
            }
            
            // Add files to our array
            files = [...pngFiles];
            currentFile = files[0]; // Set the first file as current
            originalFileSize = currentFile.size;
            
            // Show file list
            updateFileList();
            
            // Show preview of the first file
            showPreview(currentFile);
            
            // Enable convert button if we have files
            convertButton.disabled = files.length === 0;
        }
        
        // Show preview of the selected file
        function showPreview(file) {
            if (!file) return;
            
            // Show preview container and loading indicator
            previewContainer.classList.remove('d-none');
            previewLoading.style.display = 'block';
            previewImage.style.opacity = '0.3';
            
            // Create file reader for preview
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Delay to simulate loading (can be removed in production)
                setTimeout(() => {
                    previewImage.src = e.target.result;
                    previewImage.style.opacity = '1';
                    previewLoading.style.display = 'none';
                }, 800);
            };
            
            reader.readAsDataURL(file);
        }
        
        // Update file list display
        function updateFileList() {
            if (files.length === 0) {
                fileList.classList.add('d-none');
                return;
            }
            
            fileList.classList.remove('d-none');
            fileItems.innerHTML = '';
            
            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                // Create file reader to get thumbnail
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.className = 'thumbnail';
                    fileInfo.prepend(imgElement);
                };
                reader.readAsDataURL(file);
                
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                
                const fileIcon = document.createElement('i');
                fileIcon.className = 'fas fa-file-image file-icon';
                fileInfo.appendChild(fileIcon);
                
                const fileDetails = document.createElement('div');
                fileDetails.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-size text-muted">${formatFileSize(file.size)}</div>
                `;
                fileInfo.appendChild(fileDetails);
                
                const fileActions = document.createElement('div');
                fileActions.className = 'actions';
                
                const previewBtn = document.createElement('button');
                previewBtn.className = 'btn btn-sm btn-outline-primary';
                previewBtn.innerHTML = '<i class="fas fa-eye"></i>';
                previewBtn.addEventListener('click', function() {
                    currentFile = file;
                    originalFileSize = currentFile.size;
                    showPreview(file);
                });
                fileActions.appendChild(previewBtn);
                
                const removeButton = document.createElement('button');
                removeButton.className = 'btn btn-sm btn-outline-danger';
                removeButton.innerHTML = '<i class="fas fa-times"></i>';
                removeButton.addEventListener('click', function() {
                    files.splice(index, 1);
                    updateFileList();
                    convertButton.disabled = files.length === 0;
                    
                    if (files.length > 0) {
                        currentFile = files[0];
                        originalFileSize = currentFile.size;
                        showPreview(currentFile);
                    } else {
                        previewContainer.classList.add('d-none');
                    }
                });
                fileActions.appendChild(removeButton);
                
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(fileActions);
                fileItems.appendChild(fileItem);
            });
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Calculate size reduction percentage
        function calculateSizeReduction(originalSize, newSize) {
            const reduction = ((originalSize - newSize) / originalSize) * 100;
            return Math.round(reduction);
        }
        
        // Handle new conversion button click
        newConversionButton.addEventListener('click', function() {
            // Reset UI
            resultContainer.style.display = 'none';
            files = [];
            currentFile = null;
            convertedBlob = null;
            convertedFileName = '';
            
            fileInput.value = '';
            previewContainer.classList.add('d-none');
            convertButton.disabled = true;
            fileList.classList.add('d-none');
            
            // Show dropzone and convert button
            dropzone.style.display = 'block';
            convertButton.style.display = 'block';
        });
        
        // Handle download button click
        downloadButton.addEventListener('click', function() {
            if (!convertedBlob) return;
            
            // Show loading spinner on the download button
            const originalButtonText = downloadButton.innerHTML;
            downloadButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Downloading...';
            downloadButton.disabled = true;
            
            // Short timeout to ensure the loading state is visible
            setTimeout(() => {
                const downloadUrl = URL.createObjectURL(convertedBlob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = convertedFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(downloadUrl);
                
                // Restore button after download starts
                setTimeout(() => {
                    downloadButton.innerHTML = originalButtonText;
                    downloadButton.disabled = false;
                }, 1000);
            }, 500);
        });
        
        // Handle form submission
        convertForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (files.length === 0 || !currentFile) {
                alert('Please select at least one PNG file to convert.');
                return;
            }
            
            // Show loading overlay
            loadingOverlay.style.display = 'flex';
            loadingMessage.textContent = 'Converting image...';
            
            // Create FormData
            const formData = new FormData();
            formData.append('files', currentFile);
            
            // Submit for conversion
            fetch('/api/png-to-webp/convert/', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Conversion failed');
                }
                
                // Get filename from the response headers
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = currentFile.name.replace('.png', '.webp');
                
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename="(.+)"/);
                    if (filenameMatch && filenameMatch[1]) {
                        filename = filenameMatch[1];
                    }
                }
                
                convertedFileName = filename;
                
                // Get file type from response
                const contentType = response.headers.get('Content-Type');
                
                return response.blob().then(blob => ({
                    blob: blob,
                    filename: filename,
                    contentType: contentType
                }));
            })
            .then(data => {
                // Save converted blob
                convertedBlob = data.blob;
                convertedFileSize = data.blob.size;
                
                // Calculate size reduction
                const reductionPercentage = calculateSizeReduction(originalFileSize, convertedFileSize);
                
                // Hide loading overlay
                loadingOverlay.style.display = 'none';
                
                // Hide dropzone and convert button
                dropzone.style.display = 'none';
                convertButton.style.display = 'none';
                
                // Show result
                resultContainer.style.display = 'block';
                
                // Set result preview
                const blobUrl = URL.createObjectURL(data.blob);
                resultPreview.src = blobUrl;
                compareConverted.src = blobUrl;
                
                // Set file details
                resultFileName.textContent = data.filename;
                resultFileSize.textContent = formatFileSize(data.blob.size);
                sizeDifference.innerHTML = `<span class="file-size-reduction">Size reduced by ${reductionPercentage}%</span>`;
                
                // Set comparison view
                const originalReader = new FileReader();
                originalReader.onload = function(e) {
                    compareOriginal.src = e.target.result;
                };
                originalReader.readAsDataURL(currentFile);
                
                // Set file details for comparison
                originalDetails.textContent = `${currentFile.name} (${formatFileSize(currentFile.size)})`;
                convertedDetails.textContent = `${data.filename} (${formatFileSize(data.blob.size)})`;
                
                // Hide file list and preview
                fileList.classList.add('d-none');
                previewContainer.classList.add('d-none');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during conversion. Please try again.');
                
                // Hide loading overlay
                loadingOverlay.style.display = 'none';
            });
        });
    });
</script>
{% endblock %}